<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
    <title>Home | Fast Food Fast!</title>
    <link rel="stylesheet" href="../css/styles.css" type="text/css" />
</head>

<body onload="getMenuItems()">

<div id="main_wrapper">

    <div class="main-menu">
        <div class="sidebar-nav">
            <ul class="nav nav-tabs nav-menu">
                <li><a class="nav-link active" href="index.html"> Home</a></li>
                <li><a class="nav-link" href="order_history.html">Order History</a></li>
                <li><a class="nav-link" href="../home.html">Logout</a></li>
            </ul>
        </div>

    </div>

    <div class="left_box">
        <div class="box-header well">
            <h2>Menu</h2>
        </div>

        <div class="center">
                <div class="alert alert-info" id="alert-box" style="display:none;">
                    Click on the <div class="circle plus"></div> icon to add an item to your order
                </div>
            </div>

        <div class="form_content" id="menu_div" style="visibility:hidden;">
            <form method="post" action="">

                <div class="menu_item">
                    <div class="item header">
                        <h2>Available Items</h2>
                    </div>

                    <div class="fooditems" id="fooditems">
                        <!-- populate items dynamically -->
                    </div>


                </div>

            </form>

        </div>
    </div>

    <div class="checkout_box">
           
         <h2>Your Order</h2>

         <form method="post" action="index.html" name="order_form">
         <div class="order_item" id="added_item">
            <div id="default_label">Nothing ordered yet</div>
            </div>
        
            <div class="spacer"></div>

            <div class="form-btn center">
                    <div class="btn-submit">
                        <input type="button" class="center button button_round_corner button_green" onclick="submitClientOrder()" value="Submit Order">
                    </div>
                </div>
            </form>
                
    </div>

</div>

<script>
    window.onscroll = function() {myFunction()};

    var navbar = document.getElementById("navbar");
    var sticky = navbar.offsetTop;

    function myFunction() {
        if (window.pageYOffset >= sticky) {
            navbar.classList.add("sticky")
        } else {
            navbar.classList.remove("sticky");
        }
    }

    function item_clicked(food, price, id){
        var foods = []
        document.getElementById('default_label').innerHTML='';
        var div = document.getElementById('added_item');

        var data = '<div class="food_item_label">'
                    + '<span> '+food+' </span>'
                    +'</div>'
                    +'<div class="quantity-field">'
                    +'Qty: <input type="number" size="10" id="mynumber" name="mynumber" min="1" value="1" />'
                    +'</div>'
                    +'<div class="new_total">'
                    +'<span>' +price +'</span>'
                    +'<input type="number" size="10" id="food_id" name="food_id" min="1" value="'+id+'" hidden />'
                    +'</div>'
                    +'<div class="spacer"></div>';
                
            div.innerHTML += data;
        
        
    }

    function getMenuItems() {
        return fetch('https://tims-fast-food.herokuapp.com/api/v1/menu', {
        }).then(response => response.json())
        .then(response => {
            console.log('Request succeeded with JSON response', response);
            var count = Object.keys(response['menu']).length;
            var items_div = document.getElementById("fooditems");
            document.getElementById("alert-box").style.display = 'block';
            if (count > 0){
                document.getElementById("menu_div").style.visibility = 'visible';
                for(var i=0; i < count; i++)
                {
                    var row = '<div class="food_item">';
                    row += '<div class="food_image">';
                    var img_name = (response['menu'][i]['name']).toLowerCase();
                    img_name = img_name.replace(/ + /g, "_");
                    row += '<img src="../img/'+img_name+'.jpg" alt="Rice + Chapatti" />';
                    row += '</div>';
                    row += '<div class="food_item_label">';
                    row += '<h3><span>' + response['menu'][i]['name'] + '</span></h3>';
                    row += '</div>';
                    row += '<div class="price-right">';
                    row += '<span><a href="#" onclick="item_clicked(\''+ response['menu'][i]['name'] +'\', '+ response['menu'][i]['price'] +','+response['menu'][i]['id']+')">'+ response['menu'][i]['price'] +'Ush';
                    row += '<div class="circle plus"></div>';
                    row += '</a></span>';
                    row += '</div>';
                    row += '</div>';
                   
                    items_div.innerHTML += row;
                }
            }
            else{
                document.getElementById("alert-box").innerHTML = 'No items available to order';
            }
                    
        })
        .catch(function (error) {
            console.log('Request failed', error);
        });
    }
</script>

<script>
    
</script>
<script src="../js/scripts.js"></script>
</body>
</html>